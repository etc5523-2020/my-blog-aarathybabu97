---
title: Coronavirus in USA
author: Aarathy Babu
date: '2020-09-17'
slug: usa
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2020-09-17T18:53:09+10:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---


The **Coronavirus disease 2019 (COVID-19)** is the most discussed and relevant issue that the world is facing in the year 2020.What began in Wuhan, has spread over the globe in a matter of moments. With practically 30.1 million total cases world wide,the pandemic has shown it's ugliest side in certain nations than the others.Countries like the United States of America,India, Brazil are few of the many countries facing the brunt of the global pandemic right now.The rise of COVID-19 and its resultant deaths has also shown light towards the racial disparity in society.The most certain statement we can make as of now is that, COVID-19 is digging in for the long haul and has cleared path for a 'new normal' where masks,face shields and sanitizers are our new closest companions and social distancing,our better approach for living.Therefore it is intriguing to analyze how often masks are being used in the worst hit states of US and also how proportion of deaths pan out across different ethnic groups in one of the most diverse cities in the world,New York City.  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE,warning=FALSE,fig.align = 'center')
library(tidyverse)
library(tidycovid19)
library(gganimate)
library(ggplot2)
library(readr)
library(zoo)
library(naniar)
library(htmltools)
library(tidyr)
library(leaflet)
library(tidycensus)

```


```{r data}
mask<-  read_csv(here::here("datasets/us/mask-use-by-county.csv"))
counties <- read_csv(here::here("datasets/us/us-counties.csv"))
states <- read_csv(here::here("datasets/us/us-states.csv"))
nycdeaths <- read_csv(here::here("datasets/us/nycdeaths.csv"))
data("fips_codes")
fips <- fips_codes

```
## Data Description 

The primary source for the data used in the analysis is the [github page maintained by The New York Times](https://github.com/nytimes/covid-19-data) where an extensive collection of data related to the COVID-19 pandemic is maintained.The New York Times releases a series of data files with cumulative counts of cases and deaths with respect to each county and state in US . Each row of data comprises of the state or county name ,their cumulative counts of cases and deaths which includes confirmed and probable counts on the criteria that was developed by states and the federal government.It also contains the date of the event and the FIPS code of the state. The dataset used in this analysis have all the data recorded till 2020-09-12.

A glimpse of the dataset on the cases and deaths in each county is as shown in table \@ref(tab:tab1) below,

```{r tab1, fig.cap="Glimpse of the dataset on County wise cases and deaths"}
counties <- counties %>% filter(county!="Unknown")
library(kableExtra)
counties %>% head(5) %>% kable()%>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed",full_width = F, position = "float_right")) 

```


In order to have a better sense of understanding how prevalent mask usage is,the data on their [survey on mask usage](https://www.nytimes.com/interactive/2020/07/17/upshot/coronavirus-face-mask-map.html) that has the estimates share of people in a particular county that responded to the question, _How often do you wear a mask in public when you expect to be within six feet of another person?_ , was used.The survey data contains fields with the following definitions,

- **COUNTYFP**: The county FIPS code.  
- **NEVER**: The estimated share of people in this county who would say **never** in response to the question “How often do you wear a mask in public when you expect to be within six feet of another person?”  
- **RARELY**: The estimated share of people in this county who would say **rarely**  
- **SOMETIMES**: The estimated share of people in this county who would say **sometimes**  
- **FREQUENTLY**: The estimated share of people in this county who would say **frequently**  
- **ALWAYS**: The estimated share of people in this county who would say **always** 

Along with the New York Times data,the R package *tidycensus* was also used to obtain the FIPS code of each county as the FIPS code in the survey data set required formating.To analyse the racial disparity in COVID-19 deaths in New York, the dataset published by the [National Center for Health Statistics](https://data.cdc.gov/NCHS/Deaths-involving-coronavirus-disease-2019-COVID-19/ks3g-spdg) which has the data on the deaths involving coronavirus disease 2019 (COVID-19), pneumonia, and influenza reported to NCHS by race, age, and state.. The dataset used in the analysis has all the records till  The dataset used in this analysis have all the data recorded till 2020-09-16 and contains the following variables,

- **data_as_of** : Date of Analysis    

- **state** : State 

- **age_group_new** :Age Group

- **race_and_hispanic_origin**: Race and Hispanic Origin Group

- **covid_19_deaths** : Deaths involving COVID

- **pneumonia_and_covid_19_deaths** : Deaths involving COVID and Pneumonia

- **pneumonia_influenza_or_covid** : Deaths due to  Pneumonia or Influenza or COVID 

```{r naniar}
library(naniar)

deathtoll <- nycdeaths %>%
  rename(age='Age group',
         state=State,
         race='Race and Hispanic Origin Group',
         deaths='COVID-19 Deaths',
         pnumdeath='Pneumonia and COVID-19 Deaths',
         picdeath='Pneumonia, Influenza, or COVID-19 Deaths') %>%
  mutate(deaths=deaths+pnumdeath) %>%
  dplyr::select(state,age,race,deaths)
deathtoll <- deathtoll %>%
dplyr::filter(race!="Unknown") # 25 unknown values

deathtoll[is.na(deathtoll)] = 0
```


The limitation of this dataset would be the presence of the *"Unknown"* values for Race and Ethnicity. Let us now look at how often a mask is used in USA. 


## How often is a mask used in worst hit states in USA?

To analyze how often a mask is being used in a state,the average estimates for the frequencies of mask usage was calculated for each state.The table \@ref(fig:DT) shows the frequencies of mask usage in different states of USA arranged according to decreasing number of cases. We can see that California is leading with the highest number of cases and even though California has the highest number of positive cases, New York has a significantly higher deaths when compared to other states. 

```{r wrangle}

notna <- counties %>% filter(county!="Unknown")%>%
 filter(is.na(fips)) %>%
  distinct(state,county,fips)

counties <- counties %>% filter(county!="Unknown")

 joinmask <- left_join(counties,mask,by=c("fips"="COUNTYFP"))


```

```{r mask}
state_mask <- joinmask %>%
  group_by(state) %>%
  summarise(NEVER=mean(NEVER,na.rm = T),
            RARELY=mean(RARELY,na.rm = T),
            SOMETIMES=mean(SOMETIMES,na.rm = T),
            FREQUENTLY=mean(FREQUENTLY,na.rm = T),
            ALWAYS=mean(ALWAYS,na.rm = T)
            )

state_cases <- states %>%
  group_by(state)%>%
  summarise(cases=max(cases),
            deaths=max(deaths))

state_mask_full <- left_join(state_cases,state_mask,by="state") %>% 
  filter(!is.na(NEVER))


```

```{r DT}
library(DT)

table <- state_mask_full %>%
  
  mutate(NEVER=round(NEVER*100,2),
         RARELY=round(RARELY*100,2),
         SOMETIMES=round(SOMETIMES*100,2),
         FREQUENTLY=round(FREQUENTLY*100,2),
         ALWAYS=round(ALWAYS*100,2)) %>%
  
  rename(State=state,
         Cases=cases,
         Deaths=deaths,
         Never=NEVER,
         Rarely=RARELY,
         Sometimes=SOMETIMES,
         Frequently=FREQUENTLY,
         Always=ALWAYS) %>%
  arrange(desc(Cases))

widgetframe::frameWidget(datatable(table))
```


Let us now look at the frequency of mask usage in the top 10 states where COVID-19 has high incidence. We can see from the figure \@ref(fig:always) the proportion of people in each state wearing masks always,frequently, sometimes,rarely and also never wearing masks.With such high incidence of COVID-19 in these states,it is reasonable to see that the proportion of people who never wear any kind of mask is very low and that the proportion of people who always wear mask is higher.An interesting pattern we can see here is that California being the state with highest number of cases is only third to New York where more than 75% of people wear mask always when they are in near proximity to other people.This could be because the occurance of deaths in New York is higher than that of California.We can also see that in New Jersey being the state with second highest number of deaths comes second to New York in terms of proportion of people wearing masks always. With that being said, Texas with higher rate of deaths has lower proportion of such people compared to California.This pattern can be seen in reverse for all other mask wearing frequencies. For example, New York has the lowest proportion of people who never wears masks where as Tennessese has the highest proportion. This hold true for every other usage frequency except for frequent usage where we can see that Illinois has higher share of people when compared to Tennessese. 

```{r always}
top <- state_mask_full %>%
  pivot_longer(cols = c(4:8),names_to="frequency",values_to="value") %>%
  arrange(desc(cases)) 

top10 <- top %>%
  distinct(state)%>%
  head(10)

retop <- top %>%
  filter(state %in% top10$state)

retop <- retop %>%
  group_by(state) %>%
  arrange(desc(value)) %>%
  mutate(value=value*100)

cols <- c("#233d4d", "#fe7f2d", "#fcca46","#a1c181","#619b8a")
cols2 <- c("#233d4d", "#fe7f2d", "#fcca46","#a1c181","#083d77","#513b56","#98ce00","#348aa7","#840032","#db3a34")

  retop$Id <- seq(1:nrow(retop))
  
  
ggplot(retop)+
  geom_col(aes(x=frequency,y=value,
              group=Id,
               fill=state),position = 'dodge',
           width = 0.7)+
  scale_fill_manual(values = cols2)+
  scale_y_continuous(breaks = seq(0,100,by=20))+
  ylim(0,100)+
  theme(legend.position = "top",
  panel.background = element_rect(fill = "#f1f2f6",
color = "black", size = 1),
legend.title = element_blank())+
  ggtitle("Mask usage in worst hit states in the US")+
  theme(plot.title = element_text(hjust = 0.5))+
  xlab("\nUsage Frequency")+
  ylab("Estimated Share of People (%)\n") 


```


Now that we are seeing patterns in deaths and mask usage in state, let us dive into analyzing the correlation between the incidence of cases and deaths with the frequency of mask usage.

```{r ggpairs, fig.height=6.5,fig.width=7}
library(GGally)
options(scipen = 999)

lowerFn <- function(data, mapping, method = "lm", ...) {
  p <- ggplot(data = data, mapping = mapping) +
    geom_point(colour = "cyan4",size=0.9) 
  p
}

ggpairs(state_mask_full,columns=c(2:8),columnLabels = c("Cases","Deaths","Never","Rarely","Sometimes","Frequently","Always"),lower = list(continuous = wrap(lowerFn)),title = "Relationship between COVID positive cases and Mask Usage") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  theme(legend.position = "top",
         plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"),
  panel.background = element_rect(fill = "#f1f2f6"))
  




```


As seen in figure \@ref(fig:ggpairs), Cases and deaths have a positive correlation that is with the cases going up, it is likely for the death figures to go up too. It is also evident from the figure that deaths have a positive correlation with the proportion of people wearing mask always and a negative correlation with other frequencies. This can also be seen in cases of cases too but whats more interesting is that the correlation is more between deaths and frequency 'always' is more than what 'always' has with cases. Therefore, it explains the pattern we saw in New York having higher proportion of regular mask wearing population.

Another interesting point to note is that if there is a large proportion of people not wearing masks then it is also likely that there is a presence of people wearing masks rarely.
 
```{r nycd}

nyc <- counties %>%
  filter(state=="New York")


newyork <- nyc %>%
  filter(county!="Unknown") %>%
  group_by(county) %>%
  summarise(cases=max(cases),
            deaths=max(deaths)) %>%
  mutate(county=paste0(county," County"))
newyork$county <- recode(newyork$county,
                         "New York City County"="New York State")

```

```{r toll}

one <- deathtoll %>%
dplyr::filter(state=="New York") %>%
  group_by(race) %>%
  summarise(deaths=sum(deaths))%>%
  arrange(desc(deaths)) %>%
  mutate(proportion=round((deaths/sum(deaths))*100,2))%>%
  filter(proportion>0)

 one %>% ggplot()+
  geom_col(aes(y=reorder(race,proportion),x=proportion,
               fill=race),width=0.8)+
  scale_fill_manual(values = cols)+
  scale_x_continuous(breaks = seq(0,100,by=10))+

  theme(legend.position = "top",
  panel.background = element_rect(fill = "#f1f2f6",
color = "black", size = 1),
legend.title = element_blank())+
  ggtitle("Fatality in New York excluding New York City")+
  theme(plot.title = element_text(hjust = 0.5))+
  ylab("Ethnic Groups\n")+
  xlab("\nFatality rate (%)") +
   theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"))

two <- deathtoll %>%
dplyr::filter(state=="New York City") %>%
  group_by(race) %>%
  summarise(deaths=sum(deaths))%>%
  arrange(desc(deaths)) %>%
  mutate(proportion=round((deaths/sum(deaths))*100,2))%>%
  filter(proportion>0)

 two %>% ggplot()+
  geom_col(aes(y=reorder(race,proportion),x=proportion,
               fill=race),width=0.8)+
  scale_fill_manual(values = cols)+
  scale_x_continuous(breaks = seq(0,100,by=10))+

  theme(legend.position = "top",
  panel.background = element_rect(fill = "#f1f2f6",
color = "black", size = 1),
legend.title = element_blank())+
  ggtitle("Fatality in New York City")+
  theme(plot.title = element_text(hjust = 0.5))+
  ylab("Ethnic Groups\n")+
  xlab("\nFatality rate (%)") +
   theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"))



```

