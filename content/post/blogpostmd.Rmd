---
title: "Coronavirus in Brazil"
author: "Aarathy"
date: '2020-09-02'
slug: blogpostmd
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2020-09-02T13:22:25+10:00'
featured: yes
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

2019 Novel Coronavirus (2019-nCoV) is a virus (more specifically, a coronavirus) identified as the cause of an outbreak of respiratory illness first detected in Wuhan, China. Early on, many of the patients in the outbreak in Wuhan, China reportedly had some link to a large seafood and animal market, suggesting animal-to-person spread. However, a growing number of patients reportedly have not had exposure to animal markets, indicating person-to-person spread is occurring. At this time, itâ€™s unclear how easily or sustainably this virus is spreading between people - CDC

This dataset has information on the number of cases in Brazil. Please note that this is a time series data and so the number of cases on any given day is a cumulative number.

The data is available from Jan/30/2020, when the first suspect case appeared in Brazil.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE,warning=FALSE)
library(tidyverse)
library(tidycovid19)
library(coronavirus)
library(ggplot2)
library(readr)
library(zoo)
library(naniar)
library(visdat)
library(tidyr)
library(leaflet)
```


```{r data}
region<-  read_csv(here::here("datasets/brazil/brazil_covid19.csv"))

city_coord <- read_csv(here::here("datasets/brazil/brazil_cities_coordinates.csv"))

city <- read_csv(here::here("datasets/brazil/brazil_covid19_cities.csv"))

city_pop<- read_csv(here::here("datasets/brazil/brazil_population_2019.csv"))

```

```{r wrangle}

 
city_pop_join <- city %>% 
  left_join(city_pop,by=c("name"="city"))
  
city_coord_join<- city %>% 
  left_join(city_coord,by=c("name"="city_name"))
states <- city_pop %>%
  distinct(state)%>% arrange((state))

city_state <- city %>%
  distinct(state) %>% arrange((state)) %>% rename(abbr_state=state)

combine <- cbind(states,city_state)
  

combine$abbr_state <- recode(combine$abbr_state,
                             "AP"="AM",
                             "AM"="AP",
                             "MG"="MT",
                             "MT"="MG",
                             "PE"="PR",
                             "PI"="PE",
                             "PR"="PI",
                             "RO"="RS",
                             "RR"="RO",
                             "RS"="RR",
                             "SE"="SP",
                             "SP"="SE")

```


```{r}
library(tidycovid19)
library(gganimate)
library(lubridate)


brz <- download_merged_data(cached = TRUE, silent = TRUE)


brz_filter <- brz %>%
  filter(country == "Brazil") 

brz_filter%>%
  mutate(
    new_cases = confirmed - lag(confirmed),
    avg_new_cases = rollmean(new_cases, 7, na.pad=TRUE, align="right")
  ) %>%
  filter(!is.na(new_cases), !is.na(avg_new_cases)) %>%
  ggplot(aes(x = date)) +
  geom_line(aes(y = avg_new_cases), color ="#d62828") +
  theme_minimal() + xlab("Date")+
  ylab("New cases")+
  scale_x_date(date_breaks = "1 month", date_labels = "%b")+
  transition_reveal(date)

```


```{r}

sele <- city_pop_join %>%
  mutate(population = as.numeric(population)) %>%
  select(state.x, name, cases, deaths, population) %>%
  group_by(state.x, name, population) %>%
  summarise(cases = max(cases),
            deaths = max(deaths))



selebefore <- sele %>%
  group_by(state.x, name) %>%
  summarise(population = sum(population))

sele <- sele %>%
  select(state.x, name, cases, deaths) %>%
  left_join(selebefore, by = "name") %>% select(-state.x.y)

sele$population <- sele$population %>% replace_na("Unknown")

sele <- full_join(sele, combine, by = c("state.x.x" = "abbr_state")) %>%
  rename(state_abbr = state.x.x,
         city_name = name)

sele <- sele %>%
  group_by(state, city_name, population) %>%
  summarise(cases = max(cases),
            deaths = max(deaths)) %>%
  arrange(desc(cases, as.numeric(population)))





```

```{r}



leaf <- city_coord_join %>% group_by(state,name,lat,long) %>%
  summarise(cases=max(cases)) 
leaf <- leaf %>% arrange(desc(cases))
top50 <- head(leaf,50)



  map <- leaflet(data = top50,options = leafletOptions(minZoom = 4)) %>% addTiles() %>% 
  addCircleMarkers(~long, ~lat, popup = ~as.character(name), label = ~as.character(name),radius = leaf$cases/5000, color="darkred",fillOpacity = 0.1)
  
setMaxBounds(map, -28.628965, 5.269331,-73.983063,-33.868906) %>%
  setView(-46.6395,-23.532900,zoom=4)

```

2019 Novel Coronavirus (2019-nCoV) is a virus (more specifically, a coronavirus) identified as the cause of an outbreak of respiratory illness first detected in Wuhan, China. Early on, many of the patients in the outbreak in Wuhan, China reportedly had some link to a large seafood and animal market, suggesting animal-to-person spread. However, a growing number of patients reportedly have not had exposure to animal markets, indicating person-to-person spread is occurring. At this time, itâ€™s unclear how easily or sustainably this virus is spreading between people - CDC

This dataset has information on the number of cases in Brazil. Please note that this is a time series data and so the number of cases on any given day is a cumulative number.

```{r, fig.height=5}
library(DT)
library(widgetframe)
frameWidget(datatable(sele, extensions = 'Responsive',
                                       colnames = c('S.No','State', 'City', 
                                                    'Population', 'Cases', 'Deaths'), filter = 'top',  options = list(pageLength = 5, autoWidth = TRUE,height = 'auto',scroller = TRUE)))



```


```{r}
table2 <- brz_filter%>%
  mutate(
    new_cases = confirmed - lag(confirmed),
    new_deaths = deaths - lag(deaths),
    new_recover = recovered - lag(recovered),
    avg_new_cases = rollmean(new_cases, 7, na.pad=TRUE, align="right"),
    avg_new_deaths = rollmean(new_deaths, 7, na.pad=TRUE, align="right"),
    avg_new_recover = rollmean(new_recover, 7, na.pad=TRUE, align="right")
    ) %>%
  filter(!is.na(new_cases))
```





2019 Novel Coronavirus (2019-nCoV) is a virus (more specifically, a coronavirus) identified as the cause of an outbreak of respiratory illness first detected in Wuhan, China. Early on, many of the patients in the outbreak in Wuhan, China reportedly had some link to a large seafood and animal market, suggesting animal-to-person spread. However, a growing number of patients reportedly have not had exposure to animal markets, indicating person-to-person spread is occurring. At this time, itâ€™s unclear how easily or sustainably this virus is spreading between people - CDC

This dataset has information on the number of cases in Brazil. Please note that this is a time series data and so the number of cases on any given day is a cumulative number.


```{r , results='asis'}
library(arsenal)
mycontrols  <- tableby.control(test=FALSE, total=FALSE,
                               numeric.test="kwt", cat.test="chisq",
                               numeric.stats=c("mean", "median", "q1q3","range", "Nmiss2"),
                               cat.stats=c("countpct","Nmiss2"),
                               stats.labels=list(
                                                 mean="Mean",
                                                 median='Median', q1q2 = 'Quantiles(Q1,Q2)',
                               range = "Min - Max",
    Nmiss2 = "Missing"))

my_labels <- list(
  avg_new_cases = "Daily Cases",
  avg_new_deaths = "Daily Deaths",
  avg_new_recover = "Daily recovery"
)
tab2 <- tableby(~avg_new_cases + avg_new_deaths +avg_new_recover , data=table2, control=mycontrols)

summary(tab2, labelTranslations = my_labels, title = "Data")  
```



